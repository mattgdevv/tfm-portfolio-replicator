# Portfolio Replicator TFM

**Sistema ETL de detecci√≥n de arbitraje multi-fuente para CEDEARs vs activos subyacentes con estimaci√≥n inteligente**

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://python.org)
[![Async](https://img.shields.io/badge/Async-asyncio-green.svg)](https://docs.python.org/3/library/asyncio.html)
[![Architecture](https://img.shields.io/badge/Architecture-DI-orange.svg)](https://en.wikipedia.org/wiki/Dependenc### üìã Casos de Uso Testing
```bash
# 1. Portfolio real IOL (requiere credenciales)
python main.py ‚Üí opci√≥n 1

# 2. Portfolio archivo ejemplo
python main.py ‚Üí opci√≥n 2 ‚Üí data.csv

# 3. Pipeline ETL completo
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket

# 4. Testing periodicidad (ejecuci√≥n cada 2 minutos)
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --schedule 2min
# Dejar correr unos minutos, luego Ctrl+C para detener
# Verificar m√∫ltiples registros en BD: sqlite3 output/portfolio_data.db "SELECT datetime(timestamp, 'localtime'), id FROM portfolios ORDER BY timestamp DESC LIMIT 5;"

# 5. Verificaci√≥n servicios
python main.py ‚Üí opci√≥n 9
```![TFM](https://img.shields.io/badge/TFM-Data%20Engineer-purple.svg)](#)

## ‚ö° Quick Start

```bash
# 1. Clonar repositorio
git clone https://github.com/mattgdevv/tfm-portfolio-replicator.git
cd tfm-portfolio-replicator

# 2. Crear entorno virtual
python -m venv venv
source venv/bin/activate  # En Windows: venv\Scripts\activate

# 3. Instalar dependencias
pip install -r requirements.txt

# 4. (OPCIONAL) Configurar credenciales IOL
cp .env.example .env  # Editar con IOL_USERNAME e IOL_PASSWORD si tienes cuenta

# 5a. Modo INTERACTIVO (con men√∫) - USA .prefs.json existente
python main.py

# 5b. Modo ETL AUTOM√ÅTICO (para CI/CD) - USA .prefs.json existente  
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket

# 5c. Diagn√≥stico de servicios √∫nicamente
python scripts/etl_cli.py --health-check
```

> **üí° Configuraci√≥n**: El sistema usa `.prefs.json` (incluido) para configuraci√≥n principal. Variables de entorno en `.env` son opcionales y sobrescriben `.prefs.json`.

## üéØ Dos Modos de Ejecuci√≥n

### üñ•Ô∏è **Modo Interactivo** (`main.py`)
- **Prop√≥sito**: Exploraci√≥n manual y an√°lisis paso a paso
- **Interfaz**: Men√∫ con 9 opciones
- **Usuario objetivo**: Analistas, desarrollo, testing
- **Entrada**: Input usuario (credenciales, archivos, configuraci√≥n)

### ü§ñ **Modo ETL Autom√°tico** (`scripts/etl_cli.py`)
- **Prop√≥sito**: Pipelines autom√°ticos y CI/CD
- **Interfaz**: CLI parametrizable
- **Usuario objetivo**: Sistemas autom√°ticos, batch processing
- **Entrada**: Solo par√°metros de l√≠nea de comandos

## üéØ Features

- **Real-time Arbitrage Detection** - Multi-source price comparison with configurable thresholds
- **Intelligent Fallback Estimation** - Automatic theoretical pricing when markets are closed or unavailable
- **Multi-broker Support** - IOL API, Excel/CSV (Bull Market, Cocos Capital)
- **SQLite Database Integration** - Persistent storage for portfolios, positions, arbitrage opportunities, and pipeline metrics
- **Robust Data Pipeline** - Automatic fallbacks, caching, and error handling
- **Configurable ETL** - CLI with flexible parameters and output formats
- **‚è∞ Periodic Execution** - Built-in scheduler for automated ETL runs (2min/30min/hourly/daily)
- **24/7 Analysis** - Works on weekends using international prices + CCL estimation
- **Historical Data Storage** - Track arbitrage opportunities and portfolio changes over time

## ‚öôÔ∏è Configuration

### üéöÔ∏è Jerarqu√≠a de Configuraci√≥n (prioridad descendente)

1. **ü•á Variables de entorno** (`.env` + export) - Mayor prioridad
2. **ü•à Archivo `.prefs.json`** - Configuraci√≥n principal 
3. **ü•â Defaults en c√≥digo** - Valores por defecto

### üìÅ Archivos de Configuraci√≥n

#### `.prefs.json` (Configuraci√≥n Principal)
```json
{
  "arbitrage_threshold": 0.002,
  "request_timeout": 30, 
  "cache_ttl_seconds": 180,
  "PREFERRED_CCL_SOURCE": "dolarapi_ccl"
}
```

#### `.env` (Credenciales y Overrides - Opcional)
```bash
# Credenciales IOL (solo si tienes cuenta)
IOL_USERNAME=tu_usuario
IOL_PASSWORD=tu_password

# API Keys opcionales (funcionalidades avanzadas)
FINNHUB_API_KEY=tu_finnhub_key
GEMINI_API_KEY=tu_gemini_key

# Override configuraci√≥n (sobrescribe .prefs.json)
ARBITRAGE_THRESHOLD=0.01
REQUEST_TIMEOUT=25
CACHE_TTL_SECONDS=300
```

### üñ•Ô∏è Modo Interactivo (main.py)
```bash
python main.py
# Men√∫ con 9 opciones:
# 1. Portfolio desde IOL (requiere credenciales)
# 2. Portfolio desde Excel/CSV 
# 3. Ver CEDEARs disponibles
# 4-9. Configuraci√≥n y diagn√≥sticos
```

### ü§ñ Modo ETL Autom√°tico (scripts/etl_cli.py)
```bash
# Configuraci√≥n b√°sica (usa defaults)
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket

# Configuraci√≥n personalizada
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --threshold 0.015 --timeout 45

# Todos los par√°metros + output personalizado
python scripts/etl_cli.py \
  --source excel \
  --file data.csv \
  --broker cocos \
  --threshold 0.01 \
  --timeout 45 \
  --cache-ttl 300 \
  --output results/ \
  --verbose

# Solo an√°lisis sin guardar archivos JSON (BD siempre se guarda)
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --no-save

# Modo verbose (output t√©cnico completo para debugging)
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --verbose

# Health check de servicios
python scripts/etl_cli.py --health-check

# Health check con logs t√©cnicos detallados
python scripts/etl_cli.py --health-check --verbose
```

#### üñ•Ô∏è **Control de Output**
```bash
# Modo NORMAL (por defecto) - Output limpio y profesional
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket
# Salida: Solo informaci√≥n esencial y resultados para el usuario

# Modo VERBOSE - Output t√©cnico completo
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --verbose  
# Salida: DEBUG logs, detalles HTTP, cache hits, rate limiting, etc.
```

#### üïí **Ejecuci√≥n Peri√≥dica (Scheduling)**
```bash
# Ejecutar cada 30 minutos (recomendado para producci√≥n)
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --schedule 30min

# Ejecutar cada hora
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --schedule 1hour

# Ejecutar diariamente 
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --schedule daily

# Para testing: ejecutar cada 2 minutos (solo para pruebas)
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --schedule 2min
```

**Opciones de scheduling disponibles:**
- `2min` - Cada 2 minutos (solo para testing/demos)
- `30min` - Cada 30 minutos (recomendado para desarrollo)
- `1hour` / `hourly` - Cada hora (recomendado para producci√≥n)
- `daily` - Una vez por d√≠a

**Caracter√≠sticas del scheduler:**
- ‚úÖ **Ejecuci√≥n autom√°tica** - Se ejecuta indefinidamente hasta Ctrl+C
- ‚úÖ **Logging completo** - Timestamps y contadores de ejecuci√≥n
- ‚úÖ **Persistencia en BD** - Cada ejecuci√≥n genera nuevo registro en SQLite
- ‚úÖ **Gesti√≥n de errores** - Contin√∫a ejecut√°ndose aunque falle una iteraci√≥n
- ‚úÖ **Evidencia verificable** - Registros en BD y archivos con timestamps √∫nicos

## üìä Ejemplos de Uso

### üöÄ **Caso 1: Usuario nuevo - Quick Start**
```bash
# 1. Clonar repo y setup
git clone https://github.com/mattgdevv/tfm-portfolio-replicator.git && cd tfm-portfolio-replicator
python -m venv venv && source venv/bin/activate && pip install -r requirements.txt

# 2. Probar con datos ejemplo (incluidos) - guarda JSON + SQLite
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket

# Resultado esperado: Detecci√≥n de 4 oportunidades de arbitraje ‚úÖ
```

### üè¶ **Caso 2: Usuario con cuenta IOL**
```bash
# 1. Configurar credenciales
cp .env.example .env
# Editar .env con IOL_USERNAME e IOL_PASSWORD

# 2. Modo interactivo
python main.py
# Opci√≥n 1: "Obtener portfolio desde IOL"

# 3. Verificar conexi√≥n
python main.py  
# Opci√≥n 9: "Diagn√≥stico de servicios"
```

### üìà **Caso 3: An√°lisis de archivo personalizado**
```csv
# mi_portfolio.csv
S√≠mbolo,Cantidad,Precio,Broker
AAPL,10,150.0,bullmarket
MSFT,5,300.0,bullmarket
GOOGL,8,120.0,bullmarket
```
```bash
python scripts/etl_cli.py --source excel --file mi_portfolio.csv --broker bullmarket --threshold 0.01
```

### üïí **Caso 4: ETL Peri√≥dico Autom√°tico**
```bash
# Testing/Demo: Ejecutar cada 2 minutos para ver m√∫ltiples ejecuciones r√°pido
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --schedule 2min

# Producci√≥n: Monitoreo continuo cada 30 minutos
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --schedule 30min

# An√°lisis diario autom√°tico
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --schedule daily

# Verificar ejecuciones en BD
sqlite3 output/portfolio_data.db "SELECT datetime(timestamp, 'localtime'), total_positions FROM portfolios ORDER BY timestamp DESC LIMIT 5;"
```

### üè• **Caso 5: Diagn√≥stico y Health Check**
```bash
# Verificaci√≥n r√°pida de todos los servicios
python scripts/etl_cli.py --health-check

# Diagn√≥stico detallado con logs t√©cnicos
python scripts/etl_cli.py --health-check --verbose

# En scripts automatizados - verificar antes de ETL
if python scripts/etl_cli.py --health-check; then
    echo "‚úÖ Servicios operativos, ejecutando ETL..."
    python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket
else
    echo "‚ùå Error en servicios, cancelando ETL"
    exit 1
fi

# Health check desde aplicaci√≥n interactiva
python main.py  # ‚Üí Opci√≥n 9: Diagn√≥stico de servicios
```

## üóÇÔ∏è Data Sources

| Source | Type | Support |
|--------|------|---------|
| **IOL API** | Live | ‚úÖ Real-time portfolio & prices |
| **Bull Market** | Excel/CSV | ‚úÖ Custom format parsing |
| **Cocos Capital** | Excel/CSV | ‚úÖ Custom format parsing |
| **Generic** | Excel/CSV | ‚úÖ Standard format |
| **BYMA** | API | ‚úÖ CEDEAR ratios & data |
| **Finnhub** | API | ‚úÖ International prices |
| **DolarAPI** | API | ‚úÖ CCL rates |

## üìä Output Examples

### Console Output

#### Modo Normal (Profesional)
```
üìä Configuraci√≥n ETL:
   ‚Ä¢ Threshold: 0.2% (0.002)
   ‚Ä¢ Timeout: 30s
   ‚Ä¢ Cache TTL: 180s

üìä Procesando 6 CEDEARs: UNH, SNOW, HMY, FXI, AMGN, BA
üö® OPORTUNIDAD DETECTADA: UNH - 0.2%

============================================================
üìä ETL COMPLETADO - 1 oportunidades encontradas
============================================================
üö® UNH: 0.2% - Comprar CEDEAR, vender subyacente

‚è±Ô∏è  Duraci√≥n: 35098ms
============================================================
```

#### Modo Verbose (Debugging)
```
DEBUG:asyncio:Using selector: KqueueSelector
{"ts": "2025-09-11T21:04:39.289652+00:00", "level": "INFO", "msg": "etl_started", "source": "excel"}
INFO:app.core.services:üèóÔ∏è  Construyendo servicios con dependency injection...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): finnhub.io:443
DEBUG:urllib3.connectionpool:https://finnhub.io:443 "GET /api/v1/quote?symbol=UNH HTTP/1.1" 200 None
DEBUG:app.services.international_prices:‚úÖ Precio de UNH obtenido desde finnhub: $353.61
INFO:app.services.arbitrage_detector:üö® OPORTUNIDAD DETECTADA: UNH - 0.2%
```
   ‚Ä¢ Cache TTL: 180s
   ‚Ü≥ Sobrescrito por CLI: threshold=0.015, timeout=45s

üö® OPORTUNIDAD DETECTADA: SPY - 0.5%
üö® Arbitraje detectado en SPY: 0.5%
```

### JSON Output
```json
{
  "symbol": "SPY",
  "arbitrage_percentage": 0.005,
  "recommendation": "Comprar subyacente, vender CEDEAR",
  "cedear_price_usd": 461.25,
  "underlying_price_usd": 463.89
}
```

## üíæ Database Storage

### üìä SQLite Database Schema
El sistema guarda todos los datos en una base de datos SQLite (`output/portfolio_data.db`) con 4 tablas principales:

#### `portfolios` - Informaci√≥n del portfolio
- `id`, `timestamp`, `source`, `broker`, `total_positions`
- `total_value_ars`, `total_value_usd`, `ccl_rate`, `execution_time_ms`

#### `positions` - Posiciones individuales
- `portfolio_id`, `symbol`, `quantity`, `conversion_ratio`
- `price_ars`, `price_usd`, `is_cedear`, `underlying_symbol`

#### `arbitrage_opportunities` - Oportunidades detectadas
- `portfolio_id`, `symbol`, `cedear_price_ars`, `underlying_price_usd`
- `arbitrage_percentage`, `recommendation`, `ccl_rate`, `confidence_score`

#### `pipeline_metrics` - M√©tricas del ETL
- `timestamp`, `execution_time_ms`, `records_processed`
- `opportunities_found`, `sources_status`, `data_quality_score`

### üîç Query Examples
```sql
-- Ver √∫ltimos portfolios procesados
SELECT id, broker, total_positions, timestamp 
FROM portfolios 
ORDER BY timestamp DESC LIMIT 5;

-- Mejores oportunidades de arbitraje
SELECT symbol, arbitrage_percentage, recommendation 
FROM arbitrage_opportunities 
WHERE arbitrage_percentage > 0.005 
ORDER BY arbitrage_percentage DESC;
```

## üèóÔ∏è Arquitectura del Sistema

### üì¶ Estructura del Proyecto
```
üìÅ proyecto_2/
‚îú‚îÄ‚îÄ üìÅ app/                    # Core biblioteca reutilizable
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ core/              # DI Container & Config  
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/          # L√≥gica de negocio (16 servicios)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ arbitrage_detector.py    # Detecci√≥n de oportunidades
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database_service.py      # üíæ Persistencia SQLite  
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ price_fetcher.py         # Obtenci√≥n de precios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dollar_rate.py           # Cotizaci√≥n CCL
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...                      # 12 servicios adicionales
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ integrations/      # APIs externas (IOL, BYMA)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ processors/        # Procesamiento de datos
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/            # Modelos de datos
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ utils/             # Utilidades
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ workflows/         # Flujos interactivos y comandos
‚îÇ       ‚îú‚îÄ‚îÄ interactive_flows.py    # Coordinador de flujos interactivos
‚îÇ       ‚îî‚îÄ‚îÄ üìÅ commands/            # Building blocks reutilizables
‚îÇ           ‚îú‚îÄ‚îÄ extraction_commands.py
‚îÇ           ‚îú‚îÄ‚îÄ analysis_commands.py  
‚îÇ           ‚îî‚îÄ‚îÄ monitoring_commands.py
‚îÇ
‚îú‚îÄ‚îÄ üìÅ scripts/               # Herramientas ejecutables independientes
‚îÇ   ‚îú‚îÄ‚îÄ etl_cli.py           # Pipeline ETL autom√°tico principal
‚îÇ   ‚îú‚îÄ‚îÄ download_byma_pdf.py # Descarga datos BYMA
‚îÇ   ‚îî‚îÄ‚îÄ update_byma_cedeares.py
‚îÇ
‚îú‚îÄ‚îÄ üìÅ docs/                 # Documentaci√≥n t√©cnica
‚îú‚îÄ‚îÄ üìÅ output/               # Resultados de an√°lisis y base de datos
‚îÇ   ‚îú‚îÄ‚îÄ portfolio_YYYYMMDD_HHMMSS.json  # Portfolio procesado
‚îÇ   ‚îú‚îÄ‚îÄ analysis_YYYYMMDD_HHMMSS.json   # An√°lisis de arbitraje  
‚îÇ   ‚îú‚îÄ‚îÄ portfolio_data.db               # üíæ Base de datos SQLite
‚îÇ   ‚îî‚îÄ‚îÄ status.json                     # Estado √∫ltima ejecuci√≥n
‚îú‚îÄ‚îÄ üìÅ backups/              # Versiones anteriores
‚îú‚îÄ‚îÄ main.py                  # üñ•Ô∏è Aplicaci√≥n interactiva
‚îú‚îÄ‚îÄ data.csv                 # üìä Portfolio de ejemplo
‚îî‚îÄ‚îÄ requirements.txt         # üì¶ Dependencias
```

### üîÑ Pipeline de Datos
```
üìä Input Portfolio ‚Üí üîç Detecci√≥n Formato ‚Üí üè¶ Procesamiento CEDEARs ‚Üí 
üí∞ Obtenci√≥n Precios ‚Üí üìà An√°lisis Arbitraje ‚Üí ÔøΩ Guardado BD ‚Üí ÔøΩüìã Output JSON
```

### üß© Dependency Injection
- **15 servicios especializados** con inyecci√≥n autom√°tica
- **Zero estado global** - inyecci√≥n de dependencias pura  
- **Validaci√≥n runtime** - verificaci√≥n de dependencias al inicio

### üîß Gesti√≥n de Errores
- **Degradaci√≥n elegante** - contin√∫a con datos disponibles
- **M√∫ltiples fallbacks** - DolarAPI ‚Üí IOL ‚Üí Cache ‚Üí Estimaci√≥n te√≥rica
- **Soporte 24/7** - precios te√≥ricos autom√°ticos cuando mercados cerrados
- **Logging estructurado** - reporte detallado de errores

### üß† Estimaci√≥n Inteligente
Cuando datos en tiempo real no disponibles (fines de semana, feriados, fallos API):
1. **Precios internacionales** desde Finnhub (tiempo real)
2. **Tasa CCL** desde DolarAPI (disponible 24/7)
3. **Precio te√≥rico CEDEAR** calculado usando ratios de conversi√≥n
4. **Detecci√≥n arbitraje** contin√∫a seamlessly con precios estimados

## üìö API Reference

### ETL CLI Options
```bash
--source {excel}              # Data source type
--file FILE                   # Portfolio file path  
--broker {cocos,bullmarket,generic}  # Broker format
--threshold FLOAT             # Arbitrage threshold (default: config)
--timeout INT                 # Request timeout in seconds
--cache-ttl INT              # Cache TTL in seconds  
--output DIR                 # Output directory
--no-save                    # Don't save files
--verbose                    # Modo verbose: logs t√©cnicos completos para debugging
--schedule {2min,30min,1hour,hourly,daily}  # Periodic execution
--health-check               # Solo diagn√≥stico de servicios (sin ETL)
```

### Schedule Options
- `2min` - Every 2 minutes (testing/demo only)
- `30min` - Every 30 minutes (recommended for development)
- `1hour` / `hourly` - Every hour (recommended for production)
- `daily` - Once per day (daily analysis)

### Configuration Priority
1. **CLI parameters** (highest)
2. **Environment variables** 
3. **`.prefs.json`**
4. **Code defaults** (lowest)

## üõ†Ô∏è Desarrollo

### üîß Agregar Nuevos Servicios
```python
# 1. Crear servicio en app/services/
class NewService:
    def __init__(self, dependency_service, config=None):
        self.dependency = dependency_service
        self.config = config

# 2. Registrar en app/core/services.py
def build_services(config):
    # ... otros servicios
    new_service = NewService(existing_service, config=config)
    return Services(new_service=new_service, ...)
```

### üîÑ Flujos de Trabajo
- **Interactive flows** (`app/workflows/`) - Para interacci√≥n usuario
- **ETL Pipeline** (`scripts/etl_cli.py`) - Para automatizaci√≥n
- **Commands** (`app/workflows/commands/`) - Building blocks reutilizables

### üìä Formato Portfolio CSV/Excel
```csv
S√≠mbolo,Cantidad,Precio,Broker
AAPL,10,150.0,bullmarket
MSFT,5,300.0,bullmarket
```

## üß™ Testing y Debugging

### üîç Verificar Sistema
```bash
# Health check completo de todos los servicios
python scripts/etl_cli.py --health-check

# Health check con logs t√©cnicos detallados
python scripts/etl_cli.py --health-check --verbose

# Test completo del men√∫ interactivo
python main.py
# Seleccionar opci√≥n 9: "Diagn√≥stico de servicios"

# Test pipeline ETL con datos ejemplo (modo normal)
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket

# Test pipeline ETL con output t√©cnico completo (debugging)
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket --verbose

# Test conexi√≥n IOL (requiere credenciales)
python main.py
# Seleccionar opci√≥n 1: "Obtener portfolio desde IOL"
```

### üêõ Debugging Common Issues
```bash
# Error IOL authentication
# ‚úÖ Verificar credenciales en .env
# ‚úÖ Usar opci√≥n 9 para diagnosticar conexi√≥n

# Error archivo CSV
# ‚úÖ Verificar formato en data.csv ejemplo
# ‚úÖ Especificar --broker correcto

# Error APIs externas
# ‚úÖ Verificar conexi√≥n internet
# ‚úÖ Sistema usa fallbacks autom√°ticos
```

## üß™ Testing

### ‚úÖ Sistema de Testing DI-Compatible
```python
import pytest
from app.core.services import build_services
from app.core.config import Config

def test_arbitrage_detector():
    config = Config.from_env()
    services = build_services(config)
    detector = services.arbitrage_detector
    # Test logic here...

def test_portfolio_processing():
    services = build_services(Config.from_env())
    processor = services.portfolio_processor
    # Test processing logic...
```

### ÔøΩ Casos de Uso Testing
```bash
# 1. Portfolio real IOL (requiere credenciales)
python main.py ‚Üí opci√≥n 1

# 2. Portfolio archivo ejemplo
python main.py ‚Üí opci√≥n 2 ‚Üí data.csv

# 3. Pipeline ETL completo
python scripts/etl_cli.py --source excel --file data.csv --broker bullmarket

# 4. Health check r√°pido de servicios
python scripts/etl_cli.py --health-check

# 5. Verificaci√≥n servicios interactiva
python main.py ‚Üí opci√≥n 9
```

## ÔøΩüö® Known Issues & Roadmap

### ‚ö†Ô∏è Limitaciones Actuales
- **IOL session expiry**: Re-autenticaci√≥n requerida peri√≥dicamente
- **BYMA PDF dependency**: Actualizaciones manuales para nuevos CEDEARs
- **Test suite**: Migraci√≥n a pytest con soporte DI en progreso

### üîÆ Roadmap TFM
- [ ] **Testing automatizado** completo con pytest
- [ ] **CI/CD pipeline** con GitHub Actions  
- [ ] **Docker containerization** para deployment
- [ ] **Monitoring y alertas** para producci√≥n
- [ ] **API REST** para integraci√≥n externa

## üìö Referencias TFM

### üéì Contexto Acad√©mico
Este proyecto es el **Trabajo Final de M√°ster (TFM)** para el perfil **Data Engineer**, implementando:

- **Pipeline ETL robusto** con arquitectura de microservicios
- **Gesti√≥n avanzada de datos** multi-fuente con fallbacks inteligentes  
- **Procesamiento en tiempo real** y batch con Python asyncio
- **Base de datos SQLite** para persistencia y an√°lisis hist√≥rico
- **Dependency Injection** para modularidad y testing
- **Estimaci√≥n inteligente** cuando datos en tiempo real no disponibles

### üíæ Gesti√≥n de Datos
- **Persistencia dual**: JSON (compatibilidad) + SQLite (an√°lisis)
- **Datos hist√≥ricos**: Track de portfolios y oportunidades en el tiempo
- **Integridad referencial**: Foreign keys entre portfolios, posiciones y arbitrajes
- **M√©tricas de calidad**: Seguimiento de performance del pipeline ETL
- **Queries anal√≠ticos**: F√°cil acceso para reportes y modelos ML

### üìä M√©tricas del Sistema
- **16 servicios especializados** con inyecci√≥n de dependencias (incluye DatabaseService)
- **4 fuentes de datos** con fallbacks autom√°ticos
- **2 modos de ejecuci√≥n** (interactivo + autom√°tico)
- **Soporte 24/7** incluso con mercados cerrados
- **Gesti√≥n de errores** multi-nivel con degradaci√≥n elegante
- **4 tablas SQLite** para an√°lisis y reporting completo

---

*Portfolio Replicator TFM - Sistema ETL de detecci√≥n de arbitraje multi-fuente para mercados financieros*